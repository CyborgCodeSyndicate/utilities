name: Deploy to Maven Central

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to deploy (must match an existing git tag. Example: 1.0.0)'
        required: true
        type: string

permissions:
  contents: write

jobs:
  deploy-central:
    name: Deploy to Maven Central
    runs-on: ubuntu-latest
    
    steps:
      # Use the composite action to deploy to Maven Central
      - name: Deploy Utilities to Maven Central
        uses: CyborgCodeSyndicate/utilities/pipelines/deploy-maven-central@main
        with:
          version: ${{ inputs.version }}
          # Deploy only parent-pom, commons, and shared-static-data
          # Do NOT deploy utilities (root) or pipelines modules
          modules: "shared-static-data,parent-pom,commons"
          java_version: "17"
          maven_central_username: ${{ secrets.MAVEN_CENTRAL_USERNAME }}
          maven_central_token: ${{ secrets.MAVEN_CENTRAL_TOKEN }}
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          gpg_passphrase: ${{ secrets.GPG_PASSPHRASE }}

      - name: Create GitHub Release
        if: success()
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: "v${{ inputs.version }}"
          release_name: "Release v${{ inputs.version }} - Maven Central"
          body: |
            ## ðŸ“¦ Maven Central Release
            
            Version `${{ inputs.version }}` has been deployed to Maven Central.
            
            ### Deployed Modules
            - `io.cyborgcode.utilities:parent-pom:${{ inputs.version }}`
            - `io.cyborgcode.utilities:commons:${{ inputs.version }}`
            - `io.cyborgcode.utilities:shared-static-data:${{ inputs.version }}`
            
            ### Usage
            Add the following to your `pom.xml`:
            ```xml
            <dependency>
              <groupId>io.cyborgcode.utilities</groupId>
              <artifactId>parent-pom</artifactId>
              <version>${{ inputs.version }}</version>
              <type>pom</type>
              <scope>import</scope>
            </dependency>
            ```
            
            Or for the commons module:
            ```xml
            <dependency>
              <groupId>io.cyborgcode.utilities</groupId>
              <artifactId>commons</artifactId>
              <version>${{ inputs.version }}</version>
            </dependency>
            ```
            
            ### Notes
            - Artifacts may take up to 30 minutes to appear in Maven Central
            - Search for artifacts: https://search.maven.org/search?q=g:io.cyborgcode.utilities
          draft: false
          prerelease: ${{ contains(inputs.version, '-rc-') }}
